#!/bin/bash

_find_ns() {
    if test -n "$2";then
        kubectl get $1 --all-namespaces | awk -v p=$2 '{if ($2 == p) {print $1}}'
    fi
}

_k_do() {
    local action=$1
    local kind=$2
    local object=$3
    shift 3

    local ns=$(_find_ns "$kind" "$object")
    if test -n "$ns";then
        if [ "$action" = logs ];then
            kind=
        elif [ "$action" = exec ];then
            kind=
            set -- -- "$@"
        fi

        echo kubectl -n $ns $action $kind $object $@
        kubectl -n $ns $action $kind $object $@
    else
        echo "can not find namespace for: $@"
        return
    fi
}

## get 
alias kgp='kubectl get pods --all-namespaces -o wide'
alias kgs='kubectl get svc --all-namespaces'
alias kgd='kubectl get deployment --all-namespaces'
alias kga='kubectl get all --all-namespaces'

## delete
alias kddp='_k_do delete pod'
alias kdds='_k_do delete svc'
alias kddd='_k_do delete deployment'

## describe
alias kdp='_k_do describe pod'
alias kds='_k_do describe svc'
alias kdd='_k_do describe deployment'

## edit
alias kep='_k_do edit pod'
alias kes='_k_do edit svc'
alias ked='_k_do edit deployment'

## log
alias klp="_k_do logs pod"

## kubectl -n kube-system
alias ks='kubectl -n kube-system'


alias ke='_k_do exec pod'
alias kcf='kubectl create -f'

alias cetcd="etcdctl --endpoint http://0.0.0.0:6666"
